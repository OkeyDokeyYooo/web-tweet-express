extends layout

block content
  .container
    .col-2of5.bg-white.profile.user-auth
      h3 Log in to Web Tweet
      form#signupForm
        input.input-auth(type="text" name="username" placeholder="Username" required)
        input.input-auth(type="password" name="password" placeholder="Password" required)
        input.input-auth(type="password" name="confirmPassword" placeholder="Repeat password" required)
        button.btn-primary Sign up
      h6
        | Have an account?
        a(href="/login") Log in
    .col-3of5.bg-white
      .tweet
        form(action="#")
          .row
            img.avatar-sm.v-top(src="/img/avatar.jpg" alt="avatar")
            textarea.input-tweet(placeholder="What's up?")
          .row.tweet-actions
            input.hidden(type="file")
            button.btn-clear
              i.far.fa-image
            button.btn-primary Post
      .tweet
        .row
          img.avatar-sm(src="/img/avatar.jpg" alt="avatar")
          h4
            b Yan Hong
          h5 @honlyan
          h5 April 27, 2018 6:14AM
        p New WebDxD project is coming soonâ€¦
      .tweet
        .row
          img.avatar-sm(src="/img/ph-logo.png" alt="avatar")
          h4
            b Product Hunt
          h5 @ProductHunt
          h5 April 26, 2018 10:20PM
        p
          | Who goes to banks anymore? Not you, with this UK banking app ðŸ’° https://www.producthunt.com/posts/starling-bank-2
          br
          img(src="/img/tweet.jpg" alt="tweet")

block script
  script.
    $('#signupForm').submit(function(e) {
      e.preventDefault();
      const username = $('[name=username]').val();
      const password = $('[name=password]').val();
      const confirmPassword = $('[name=confirmPassword]').val();
      if(password !== confirmPassword) {
        Swal('Oops...', 'Password does not match!', 'error')
      } else {
        $.ajax({
          method: 'POST',
          url: '/signup',
          data: {
            username,
            password
          },
          success(res) {
            if (res.token) {
              localStorage.setItem('userData', JSON.stringify(res));
              location.href='/';
            } else {
              alert(res.message || res);
            }
          }
        });
      }
    })